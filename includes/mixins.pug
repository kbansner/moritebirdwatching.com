mixin head(pageTitle)
  meta(charset='utf-8')
  meta(name='viewport', content='width=device-width, initial-scale=1')
  <!-- Global site tag (gtag.js) - Google Analytics -->
  script(async, src="https://www.googletagmanager.com/gtag/js?id=UA-126209656-1")
  script.
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-126209656-1');

  link(href='https://fonts.googleapis.com/css?family=EB+Garamond|Ovo' rel='stylesheet')
  link(href='/css/normalize-min.css', rel='stylesheet', type='text/css')
  link(href='/css/main.css', rel='stylesheet', type='text/css')
  title 
    |Morite Birdwatching: 
    =pageTitle


mixin link(href, name)
  a(href=href)&attributes(attributes)= name

mixin navigation
  nav
    +link('#contact', 'Contact Us')
    +link('#team', 'Team')
    +link('#tours', 'Tours')
    +link('#birds', 'Birds')

mixin navigation-home
  nav
    +link('index.html#contact', 'Contact Us')
    +link('index.html#team', 'Team')
    +link('index.html#tours', 'Tours')
    +link('index.html#birds', 'Birds')

mixin slider
  - var n = 1
  .slider
    while n < 13
      .slide
        .slide-background(class='slide'+n)
        span.slide-caption= n++

mixin footer
  footer
    nav
      -//+link('javascript:$(\'#main\').scrollTop(0);', 'Top')
      +link('#main', 'Top')

mixin main-js
  script(src="http://code.jquery.com/jquery-2.2.4.min.js", integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=", crossorigin="anonymous")
  script(src='/js/intersection-observer-min.js')
  script(src='/js/smoothscroll-min.js')

  script(type='text/javascript').
    $(document).ready(function() {
      var timer, pause = false, delay = 7000;
      var slideNext = function() {
        var slider = $('.slider')[0];
        slider.scrollBy({ left: slider.clientWidth, behavior: 'smooth' });
      }
      var scroller = function(){
        if (!pause) {
          slideNext();
        }
      }
      timer = setInterval(scroller, delay);

      var setPause = function(){
        pause = true;
      }
      var unsetPause = function(){
        pause = false;
        /* console.log('unsetPause') */
      }

      $('.slider')[0].addEventListener('wheel', (e) => {
        if (e.deltaX > 10 || e.deltaX < 10) {
          setPause()
        }
      });
      $('.slider').on('mouseenter', unsetPause)
      
      const slides = document.querySelectorAll('.slide');


      observer = new IntersectionObserver(entries => {
        var x = 60;
        var s = 1.2;
        entries.forEach(entry => {
          if (entry.intersectionRatio > 0) {
            console.log('in the view', entry);
            $(entry.target).addClass('on');
            s = Math.random() / 6 + 1.1;
            x = parseInt(Math.random() * 30 + 30) + 'px';
            setCssProperties(entry.target, x, s);
          } else {
            console.log('out of view');
            $(entry.target).removeClass('on');
          }
        });
      });

      slides.forEach(image => {
        observer.observe(image);
      });
      
      function setCssProperties(ele, x, s) {
        console.log('props', x, s)
        ele.style.setProperty('--x-factor', x);
        ele.style.setProperty('--scale-factor', s);
      }
      
      $('.service .arrow-prev').on('click', function(){
        $(this).siblings('.gallery')[0].scrollBy({ left: -460, behavior: 'smooth' });
      });
      $('.service .arrow-next').on('click', function(){
        $(this).siblings('.gallery')[0].scrollBy({ left: 460, behavior: 'smooth' });
      });
    });

    $(document).ready(function() { 
      $('#main').addClass('is-js');
      setTimeout(function(){
        $('.slider')
          .addClass('loaded');
      }, 1200);
    });

    // smooth scrolling hashtags
    // Select all links with hashes
    $(document).ready(function() {
      $('a[href*="#"]')
        // Remove links that don't actually link to anything
        .click(function(event) {
          // On-page links
          if (
            location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') 
            && 
            location.hostname == this.hostname
          ) {
            // Figure out element to scroll to
            var target = $(this.hash);
            event.preventDefault();
            $('#main')[0].scroll({top: target.offset().top, left: 0, behavior: 'smooth'})
            target.focus();
          }
        });
      });
mixin service-picture(url, alt)
  picture
    img(src='images/services/'+url, width='450', height='300', alt=alt)
    if alt
      figure
        =alt

mixin service-nature-walks
  .service
    .service-description
      b Guided Nature Walks
      p.
        We will take you for a walk between villages where we’ll point out local flora, fauna and farming techniques. Bring your binoculars as we are very likely to see birds along the way. Trips can be tailored to your specific interests and energy level.
      p
        |Group size: No limit
        br
        |Duration: 3 - 6 hours
    .service-picture
      .arrow.arrow-prev
      .arrow.arrow-next
      .gallery
        +service-picture('walks/jungle-walk.jpg')
        +service-picture('walks/2837200843_d605f0b9f4_o.jpg')
        +service-picture('walks/2837324099_9618887ca9_o.jpg')
        +service-picture('walks/IMG_9920.jpg')
        +service-picture('walks/R0016007.jpg')
      

mixin service-kambali-bebas
  .service
    .service-description
      b Visit to the Bird Rehabilitation Center (Kambali Bebas)
      p.
        The Rehabilitation Center is a must-see for all bird lovers visiting the area. The center houses wild caught parrots recovered from the illegal pet trade. Birds that can survive in the wild and are deemed healthy are released back to the jungles they came from.
      p 
        |Group size: No limit
        br
        |Duration: 1 hour
    .service-picture
      .arrow.arrow-prev
      .arrow.arrow-next
      .gallery
        +service-picture('kambali-bekas/_Q5A3005.jpg', 'Moluccan Cockatoos waiting to be released')
        +service-picture('kambali-bekas/_Q5A3009.jpg')
        +service-picture('kambali-bekas/_Q5A3015.jpg')
        +service-picture('kambali-bekas/_Q5A3024.jpg')
        +service-picture('kambali-bekas/_Q5A3094.jpg')
        +service-picture('kambali-bekas/_Q5A3100.jpg')
        +service-picture('kambali-bekas/IMG_1160.jpg', "Jacob says, “Saya lapar, Saya lapar (I’m hungry)”")

mixin service-viewing-platforms
  .service
    .service-description
      b Vist to Viewing Platforms
      p.
       Above the village of Masihulan are two viewing platforms sourounded by parrots’ nests. It’s a steep 15 minute hike up from the main road, but once you’re there the view is spectacular.
      p
        |Group size: up to 20 people
        br
        |Duration: 1 - 3 hours
    .service-picture
      .arrow.arrow-prev
      .arrow.arrow-next
      .gallery
        +service-picture('viewing-platforms/viewing-platform.jpg')
        +service-picture('viewing-platforms/20171028_165122.jpg')
        +service-picture('viewing-platforms/20171028_165240.jpg')

mixin service-canopy-platform-trips
  .service
    .service-description
      b Canopy Platform Trips
      p.
        Sleep in a tree. Wake up before dawn to watch the neighboring parrots begin their day by stretching and preening.
      p 
        |Group size: up to 10 people
        br
        |Duration: Several hours to overnight
    .service-picture
      .arrow.arrow-prev
      .arrow.arrow-next
      .gallery
        +service-picture('canopy-platform-trips/2838228186_c98768c564_o.jpg')
        +service-picture('canopy-platform-trips/IMG_2918.jpg')
        +service-picture('canopy-platform-trips/IMG_5740.jpg')
        +service-picture('canopy-platform-trips/IMG_3167.jpg')
        +service-picture('canopy-platform-trips/2821196152_7e3c4c92b5_o.jpg')
        +service-picture('canopy-platform-trips/2837183795_20097d5b7e_o.jpg')
        -//picture
          -//img(src='images/services/canopy-platform-trips/2838013842_6e7b1cbccc_o.jpg', width='450', height='300', alt='')
        +service-picture('canopy-platform-trips/2838055094_4f66aee101_o.jpg')
        +service-picture('canopy-platform-trips/R0016811.jpg')
        +service-picture('canopy-platform-trips/_Q5A7023.jpg')

mixin service-api-lima
  .service
    .service-description
      b Api Lima
      p.
        This shallow cave offerst a high lookout over the forest canopy. It’s a two to three hour hike from the quary where the road ends. This high cave is a great place to relax and view Cockatoos, Lories, and Hornbills from without having to ascend to tree platforms.
      p 
        |Group size: up to 6 people
        br
        |Duration: 2 days
    
    .service-picture
      .arrow.arrow-prev
      .arrow.arrow-next
      .gallery
        +service-picture('api-lima/R0015611.jpg')
        +service-picture('api-lima/IMG_1340.jpg')
        +service-picture('api-lima/2837302547_3c94b02bfb_o.jpg')
        +service-picture('api-lima/IMG_2757.jpg')
        +service-picture('api-lima/IMG_2886.jpg')
        +service-picture('api-lima/R0015672.jpg')
        +service-picture('api-lima/R0015706.jpg')
        +service-picture('api-lima/R0015973.jpg')

mixin service-custom-tree-platforms
  .service
    .service-description
      b Custom Tree Platforms
      p.
        Make a cozy platform near your favorit birds.
      p 
        |Group size: 2 people
        br
        |Duration: 3 - 5 days

    .service-picture
      .arrow.arrow-prev
      .arrow.arrow-next
      .gallery
        +service-picture('custom-platforms/IMG_1428.jpg')
        +service-picture('custom-platforms/IMG_1437.jpg')
        +service-picture('custom-platforms/20171028_165240.jpg')
        +service-picture('custom-platforms/_Q5A4034.jpg')
        +service-picture('custom-platforms/IMG_1448.jpg')
        +service-picture('custom-platforms/custom-platform.jpg')

mixin service-trekking
  .service
    .service-description
      b Trekking Across Seram
      p.
        Walk accross Seram in seven days, stay in with the village cheifs
      p 
        |Group size: up to 6 people
        br
        |Duration: 7 days
    .service-picture
      .arrow.arrow-prev
      .arrow.arrow-next
      .gallery
        +service-picture('trekking/R0016157.jpg')
        +service-picture('trekking/R0016168.jpg')
        +service-picture('trekking/R0016172.jpg')
        +service-picture('trekking/R0016403.jpg')
        +service-picture('trekking/R0016185.jpg')
        +service-picture('trekking/R0016283.jpg')
        +service-picture('trekking/R0016341.jpg')
        +service-picture('trekking/R0016342.jpg')
        +service-picture('trekking/R0016373.jpg')
        +service-picture('trekking/R0016386.jpg')
        +service-picture('trekking/IMG_3063.jpg', 'Cockatoo')
        +service-picture('trekking/R0016399.jpg')
        +service-picture('trekking/R0016432.jpg')
        +service-picture('trekking/R0016433.jpg', 'Departing Manusella Village')
        +service-picture('trekking/R0016595.jpg')
        +service-picture('trekking/R0016624.jpg')
        +service-picture('trekking/R0016734.jpg')
        +service-picture('trekking/R0016736.jpg')

mixin team-portrait(url, alt)
  picture.quarter-col.portrait
    img(class='lazyload', src='images/team/'+url, width='80', height='100', alt=alt)
    if alt
      figure
        =alt
    else 
      figure &nbsp;
